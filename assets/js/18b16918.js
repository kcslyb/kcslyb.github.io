import{e as J,f as u,r as C,o as n,c as m,g as k,a as d,w as p,F as V,b as w,h as f,u as E,k as U,d as _,m as $,p as A,_ as I}from"./bae183dd.js";import{T as M}from"./b4581679.js";import{C as H,M as z}from"./bd41ffe6.js";const G={class:"cs-flex space-between margin-bottom-20"},K={class:"export-flow"},P={class:"text-right margin-top-20"},Q=J({__name:"TxtExport",setup(W){const g=u([]),D=u([]),i=u([]),r=u([]),y=u([]),c=u(""),L=`${innerHeight-210}px`;y.value=new H().getCoverts();const b=u("");g.value=new M().getDataSource();const N=o=>{if(!o)return;const e=g.value.find(t=>t.createTime=b.value);D.value=e.header,i.value=e.content},S=()=>{r.value.push("")},j=()=>{r.value.pop()};function B(o,e){return new Function("dataList",e)(o)}const h=u(),O=()=>{var e;const o=y.value.filter(t=>r.value.includes(t.id));if(o==null||o.length===0)c.value=i.value&&typeof i.value!="string"?JSON.stringify(i.value,null,2):i.value||"";else{const t=o.reduce((a,l)=>(a=B(a,l.script),a),i.value);console.info(t),c.value=Array.isArray(t)&&typeof t!="string"?JSON.stringify(t,null,2):t||""}(e=h.value)==null||e.updateValue(c.value)};function T(o,e){const t=new Blob([o],{type:"text/plain"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}const R=()=>{T(c.value,`${new Date().getTime()}.json`)},F=()=>{T(c.value,`${new Date().getTime()}.sql`)},q=()=>{console.info("exportExcel")};return(o,e)=>{const t=C("el-option"),a=C("el-select"),l=C("el-button");return n(),m("div",null,[k("div",G,[k("div",K,[d(a,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),filterable:"",clearable:"",placeholder:"选择数据源数据",onChange:N},{default:p(()=>[(n(!0),m(V,null,w(g.value,s=>(n(),f(t,{key:s.createTime,label:s.name,value:s.createTime},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(n(!0),m(V,null,w(r.value,(s,x)=>(n(),f(a,{class:"margin-left-20",key:x,modelValue:r.value[x],"onUpdate:modelValue":v=>r.value[x]=v,filterable:"",clearable:"",placeholder:"选择转换器"},{default:p(()=>[(n(!0),m(V,null,w(y.value,v=>(n(),f(t,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128)),r.value.length<3?(n(),f(l,{key:0,class:"margin-left-20",icon:E($),circle:"",onClick:S},null,8,["icon"])):U("",!0),r.value.length?(n(),f(l,{key:1,class:"margin-left-20",icon:E(A),circle:"",onClick:j},null,8,["icon"])):U("",!0)]),d(l,{type:"primary",onClick:O},{default:p(()=>e[2]||(e[2]=[_("预览结果")])),_:1})]),d(z,{ref_key:"editor",ref:h,modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),language:"json","show-func":!1,height:L},null,8,["modelValue"]),k("div",P,[d(l,{type:"primary",onClick:R},{default:p(()=>e[3]||(e[3]=[_("导出json")])),_:1}),d(l,{type:"primary",onClick:F},{default:p(()=>e[4]||(e[4]=[_("导出sql")])),_:1}),d(l,{type:"primary",onClick:q},{default:p(()=>e[5]||(e[5]=[_("导出excel")])),_:1})])])}}});const ee=I(Q,[["__scopeId","data-v-a8c8baed"]]);export{ee as default};
