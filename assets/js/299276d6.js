import{e as j,f as s,r as x,o as n,c as p,g as C,a as f,w as m,F as h,b as k,h as v,u as w,k as T,d as U,m as A,p as I,_ as J}from"./a6a50f12.js";import{T as M}from"./45a890f3.js";import{C as $,M as H}from"./a3f1e868.js";const q={class:"cs-flex space-between margin-bottom-20"},z={class:"export-flow"},G={class:"text-right margin-top-20"},K=j({__name:"TxtExport",setup(P){const _=s([]),E=s([]),c=s([]),u=s([]),g=s([]),d=s(""),L=`${innerHeight-206}px`;g.value=new $().getCoverts();const b=s("");_.value=new M().getDataSource();const N=a=>{if(!a)return;const e=_.value.find(t=>t.createTime===b.value);E.value=e.header,c.value=e.content},R=()=>{u.value.push("")},B=()=>{u.value.pop()};function D(a,e){return new Function("dataList",e)(a)}const V=s(),O=()=>{var e;const a=g.value.filter(t=>u.value.includes(t.id));if(a==null||a.length===0)d.value=c.value&&typeof c.value!="string"?JSON.stringify(c.value,null,2):c.value||"";else{const t=a.reduce((o,l)=>(o=D(o,l.script),o),c.value);console.info(t),d.value=Array.isArray(t)&&typeof t!="string"?JSON.stringify(t,null,2):t||""}(e=V.value)==null||e.updateValue(d.value)};function S(a,e){const t=new Blob([a],{type:"text/plain"}),o=URL.createObjectURL(t),l=document.createElement("a");l.href=o,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}const F=()=>{S(d.value,`result_${new Date().getTime()}.txt`)};return(a,e)=>{const t=x("el-option"),o=x("el-select"),l=x("el-button");return n(),p("div",null,[C("div",q,[C("div",z,[f(o,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),filterable:"",clearable:"",placeholder:"选择数据源数据",onChange:N},{default:m(()=>[(n(!0),p(h,null,k(_.value,r=>(n(),v(t,{key:r.createTime,label:r.name,value:r.createTime},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(n(!0),p(h,null,k(u.value,(r,y)=>(n(),v(o,{class:"margin-left-20",key:y,modelValue:u.value[y],"onUpdate:modelValue":i=>u.value[y]=i,filterable:"",clearable:"",placeholder:"选择转换器"},{default:m(()=>[(n(!0),p(h,null,k(g.value,i=>(n(),v(t,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128)),u.value.length<3?(n(),v(l,{key:0,class:"margin-left-20",icon:w(A),circle:"",onClick:R},null,8,["icon"])):T("",!0),u.value.length?(n(),v(l,{key:1,class:"margin-left-20",icon:w(I),circle:"",onClick:B},null,8,["icon"])):T("",!0)]),f(l,{type:"primary",onClick:O},{default:m(()=>e[2]||(e[2]=[U("预览结果")])),_:1})]),f(H,{ref_key:"editor",ref:V,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value=r),language:"json","show-func":!1,height:L},null,8,["modelValue"]),C("div",G,[f(l,{type:"primary",onClick:F},{default:m(()=>e[3]||(e[3]=[U("导出结果")])),_:1})])])}}});const Y=J(K,[["__scopeId","data-v-c5619024"]]);export{Y as default};
